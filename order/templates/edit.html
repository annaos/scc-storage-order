{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content-wrapper %}
    <h1 class="mt-2">
        {% if pk %}
            Edit project
        {% else %}
            Create new project
        {% endif %}
    </h1>

    {% if error_message %}
        <p class="bigger text-danger"><strong>{{ error_message }}</strong></p>
    {% endif %}

    {% if next_state %}
        <a href="{% url 'order:order-next-state' pk %}" class="btn btn-warning float-right" onclick="window.location = {% url 'order:order-next-state' pk %}">{{ next_state }}</a>
    {% endif %}

    <form action="{% if pk %}{% url 'order:edit' pk %}{% else %}{% url 'order:new' %}{% endif %}"
          accept-charset="UTF-8"
          method="post"
    >
        {% csrf_token %}

        <h2>Project information</h2>
        {{ form.project_name|as_crispy_field }}

        <h2>Contacts</h2>
        <div class="row justify-content-center">
            <div class="col-4">
                <h5>Owner of the project</h5>
                {{ form.owner_email|as_crispy_field }}
                {{ form.owner_institute|as_crispy_field }}
                {{ form.owner_firstname|as_crispy_field }}
                {{ form.owner_lastname|as_crispy_field }}
            </div>
            <div class="col-4">
                <h5>Head of the project</h5>
                {{ form.head_email|as_crispy_field }}
                {{ form.head_institute|as_crispy_field }}
                {{ form.head_firstname|as_crispy_field }}
                {{ form.head_lastname|as_crispy_field }}
            </div>
            <div class="col-4">
                <h5>Technical contact</h5>
                {{ form.tech_email|as_crispy_field }}
                {{ form.tech_institute|as_crispy_field }}
                {{ form.tech_firstname|as_crispy_field }}
                {{ form.tech_lastname|as_crispy_field }}
            </div>
        </div>

        <h2>Project details</h2>
        {{ form.abstract|as_crispy_field }}
        {{ form.notes|as_crispy_field }}
        {{ form.end_date|as_crispy_field }}
        {{ form.capacity|as_crispy_field }}
        {{ form.directory_name|as_crispy_field }}

        <h2>Protocols</h2>
        {{ form.protocol_ssh|as_crispy_field }}
        {{ form.protocol_sftp|as_crispy_field }}
        {{ form.protocol_scp|as_crispy_field }}
        {{ form.protocol_cifs|as_crispy_field }}
        {{ form.protocol_nfs|as_crispy_field }}
        <div id="div_id_nfs_network_to_collapse">{{ form.nfs_network|as_crispy_field }}</div>

        <h2>Access control</h2>
        <div class="row justify-content-center">
            <div class="col-6">
                {{ form.owner_name|as_crispy_field }}
            </div>
            <div class="col-6">
                {{ form.group_name|as_crispy_field }}
            </div>
        </div>

        {{ form.group_permission|as_crispy_field }}
        {{ form.group_cifsacls|as_crispy_field }}

        {% if form.state %}
            <h2>State</h2>
            {{ form.state|as_crispy_field }}
        {% endif %}

        {% if pk %}
            <button type="submit" class="btn btn-success">Save changes</button>
        {% else %}
            <button type="submit" class="btn btn-success">Submit Storage Proposal</button>
        {% endif %}

        <a href="{% url 'order:index' %}" class="btn btn-danger float-right">Home</a>

    </form>

    <script type="text/javascript">
        $(function () {
            // display end_date with calender
            $("#id_end_date").datepicker({ dateFormat: 'dd.mm.yy' });

            // collapse nfs_network field if checkbox not checked
            $("#div_id_nfs_network_to_collapse").addClass("collapse");
            {% if nfs_aria_expanded == "true" %}
                $("#div_id_nfs_network_to_collapse").addClass("show");
            {% endif %}
            let nfsCheckbox = $("#id_protocol_nfs")
            if (!nfsCheckbox.attr("disabled")) {
                $("#id_protocol_nfs").parent().attr({"data-toggle":"collapse", "data-target":"#div_id_nfs_network_to_collapse", "aria-expanded":"{{ nfs_aria_expanded }}", "aria_controls":"div_id_nfs_network_to_collapse"});
            }
        });
    </script>
{% endblock %}
